#!/bin/bash
set -e

echo "ğŸš€ Starting Nix + Home Manager + Dotfiles setup..."

# 1. ç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•
cd ~/.config/home-manager

# 2. å¤åˆ¶ nix.conf
echo "ğŸ“‹ Setting up Nix configuration..."
mkdir -p ~/.config/nix
cp nix.conf ~/.config/nix/nix.conf

# 3. é¦–æ¬¡æ„å»ºï¼ˆä½¿ç”¨ Flakeï¼‰
echo "ğŸ—ï¸  Building Home Manager configuration..."
if command -v home-manager &> /dev/null; then
    home-manager switch --flake .#mzn
else
    echo "âš ï¸  Home Manager not found. Installing..."
    nix run home-manager/master -- switch --flake .#mzn
fi

echo "âœ… Setup complete! Your dotfiles are now linked."
echo "ğŸ“ Dotfiles location: ~/.config/home-manager/dotfiles/"
